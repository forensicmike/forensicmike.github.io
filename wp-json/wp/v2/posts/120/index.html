{"id":120,"date":"2019-05-02T05:28:45","date_gmt":"2019-05-02T12:28:45","guid":{"rendered":"https:\/\/3.88.229.156\/?p=120"},"modified":"2019-05-19T18:49:25","modified_gmt":"2019-05-20T01:49:25","slug":"ios-photos-sqlite-forensics","status":"publish","type":"post","link":"http:\/\/172.31.17.250\/2019\/05\/02\/ios-photos-sqlite-forensics\/","title":{"rendered":"iOS Photos.sqlite Forensics"},"content":{"rendered":"\n<p>Photos.sqlite, the iOS elephant in the room of mobile forensic vendors that is absolutely chock full of interesting information yet is completely ignored. Why is this? One possible reason is that the database can be hard to work with due to table names that vary from device to device.<\/p>\n\n\n\n<p>To answer this question, I&#8217;m bringing out the big guns &#8211; colleague and friend <a href=\"https:\/\/twitter.com\/qubytelogic\">Shafik G. Punja<\/a> &#8211; who has been working in the digital forensics field for the last 15 years and counting. Shafik&#8217;s meticulous nature and extensive knowledge and experience is unmatched and so is the perfect person to ask about this subject.<\/p>\n\n\n\n<p><strong><em>Forensicmike<\/em>: What prompted you to investigate Photos.sqlite?<\/strong><\/p>\n\n\n\n<p><em>Shafik<\/em>: I was working on an already acquired iPhone 8 on iOS 12.1.2 where the device owner had placed the images of interest in an album called &#8220;Evidence&#8221;. The guy who did the acquisition, a blogger who shall not be directly named but rhymes with forensicbike, did not check before releasing the device itself. For most if not all major forensic tools, there is no way to tell which camera roll items belong to an album. This means there is a possibility that for every single instance of a video or photo on the file system there may be membership to one or more albums. Some albums are user created while others are automatically created by iOS such as &#8216;Screenshots&#8217; or even third party applications.<\/p>\n\n\n\n<p><strong><em>Forensicmike<\/em>: I don&#8217;t know who you could be referring to! So&#8230; could you summarize the purpose of Photos.sqlite?<\/strong><\/p>\n\n\n\n<p><em>Shafik<\/em>: This SQLite database file contains information about videos and photos stored on an iOS device. Photos.sqlite contains everything from album ownership, to internal photo analysis and GPS and much more. At the time of writing, this database must be manually examined in order to identify the existence of albums which can contain photos or videos.<\/p>\n\n\n\n<p><strong><em>Forensicmike<\/em>: Shaf&#8230; there&#8217;s nearly 70 tables in this beast. Which of them are actually needed?<\/strong><\/p>\n\n\n\n<p><em>Shafik<\/em>: All of them! Just kidding. The primary ones you need to focus on for the purpose of album identification and media correlation are ZGENERICALBUM, the mystery Z_##ASSETS table, and the ZGENERICASSET table. There are a handful of other interesting ones that I&#8217;ll provide a list for at the end but those are the main ones. The mystery number is the oddest and seems to vary from device to device. It is also probably the number one reason the forensic tools are staying far away from this otherwise easy target of a database. Keep in mind this is for iOS 12.1 and could be different in future\/previous versions.<\/p>\n\n\n\n<p><strong><em>Forensicmike<\/em>: Okay, so where do we start?<\/strong><\/p>\n\n\n\n<p><em>Shafik<\/em>: If you know the album you&#8217;re interested in as I did in my case, start with ZGENERICALBUM. The ZTITLE column is where you&#8217;re headed. You can also note the ZCACHEDPHOTOSCOUNT and ZCACHEDVIDEOSCOUNT for a photo\/video count &#8211; handy!<\/p>\n\n\n\n<figure class=\"wp-block-image\"><a href=\"http:\/\/3.88.229.156\/wp-content\/uploads\/2019\/05\/1.png\"><img loading=\"lazy\" width=\"624\" height=\"213\" src=\"http:\/\/3.88.229.156\/wp-content\/uploads\/2019\/05\/1.png\" alt=\"\" class=\"wp-image-123\" srcset=\"http:\/\/172.31.17.250\/wp-content\/uploads\/2019\/05\/1.png 624w, http:\/\/172.31.17.250\/wp-content\/uploads\/2019\/05\/1-300x102.png 300w\" sizes=\"(max-width: 624px) 100vw, 624px\" \/><\/a><\/figure>\n\n\n\n<figure class=\"wp-block-image\"><a href=\"http:\/\/3.88.229.156\/wp-content\/uploads\/2019\/05\/2.png\"><img loading=\"lazy\" width=\"596\" height=\"62\" src=\"http:\/\/3.88.229.156\/wp-content\/uploads\/2019\/05\/2.png\" alt=\"\" class=\"wp-image-124\" srcset=\"http:\/\/172.31.17.250\/wp-content\/uploads\/2019\/05\/2.png 596w, http:\/\/172.31.17.250\/wp-content\/uploads\/2019\/05\/2-300x31.png 300w\" sizes=\"(max-width: 596px) 100vw, 596px\" \/><\/a><\/figure>\n\n\n\n<p>So in this case we can see there are 4 items anticipated all of which are photos. At this point you should also note the Z_PK &#8212; in this case it was 47 &#8212; as this is our primary key that we will cross reference in table number 2 &#8211; the mystery number table. On this device, it was Z23_ASSETS. So, step 2 is to check Z23_ASSETS (or Z##_ASSETS) for your Z_PK of interest.<\/p>\n\n\n\n<figure class=\"wp-block-image\"><a href=\"http:\/\/3.88.229.156\/wp-content\/uploads\/2019\/05\/4.png\"><img loading=\"lazy\" width=\"624\" height=\"201\" src=\"http:\/\/3.88.229.156\/wp-content\/uploads\/2019\/05\/3.png\" alt=\"\" class=\"wp-image-126\" srcset=\"http:\/\/172.31.17.250\/wp-content\/uploads\/2019\/05\/3.png 624w, http:\/\/172.31.17.250\/wp-content\/uploads\/2019\/05\/3-300x97.png 300w\" sizes=\"(max-width: 624px) 100vw, 624px\" \/><\/a><\/figure>\n\n\n\n<p>So we can see there are four items of interest in the Z_23ASSETS table if we filter by Z_23ALBUMS=47 (the Z_PK from ZGENERICALBUM), specifically 4490, 4491, 4492, 4493.<\/p>\n\n\n\n<p>Now we have one final table to bring into the mix&#8230; ZGENERICASSET. Take your values of interest and search for them as either RowID or Z_PK:<\/p>\n\n\n\n<figure class=\"wp-block-image\"><a href=\"http:\/\/3.88.229.156\/wp-content\/uploads\/2019\/05\/4.png\"><img loading=\"lazy\" width=\"512\" height=\"283\" src=\"http:\/\/3.88.229.156\/wp-content\/uploads\/2019\/05\/4.png\" alt=\"\" class=\"wp-image-125\" srcset=\"http:\/\/172.31.17.250\/wp-content\/uploads\/2019\/05\/4.png 512w, http:\/\/172.31.17.250\/wp-content\/uploads\/2019\/05\/4-300x166.png 300w\" sizes=\"(max-width: 512px) 100vw, 512px\" \/><\/a><\/figure>\n\n\n\n<p>Now all that&#8217;s left is to scroll to the right&#8230;keep scrolling&#8230;. never give up scrolling&#8230;. and&#8230;.victory!<\/p>\n\n\n\n<figure class=\"wp-block-image\"><a href=\"http:\/\/3.88.229.156\/wp-content\/uploads\/2019\/05\/5.png\"><img loading=\"lazy\" width=\"406\" height=\"165\" src=\"http:\/\/3.88.229.156\/wp-content\/uploads\/2019\/05\/5.png\" alt=\"\" class=\"wp-image-127\" srcset=\"http:\/\/172.31.17.250\/wp-content\/uploads\/2019\/05\/5.png 406w, http:\/\/172.31.17.250\/wp-content\/uploads\/2019\/05\/5-300x122.png 300w\" sizes=\"(max-width: 406px) 100vw, 406px\" \/><\/a><\/figure>\n\n\n\n<p><strong><em>Forensicmike<\/em>: Interesting&#8230; all PNG files &#8211; probably suggesting these could be screenshots if I recall from FOR585?<\/strong><\/p>\n\n\n\n<p>Shafik: Yes! They were screenshots &#8211; but that&#8217;s not the only thing you can understand from the querying we&#8217;ve done so far. Take a look at the ZDATECREATED for a UTC based creation time, and ZADDEDDATE for a &#8216;added to album time&#8217; &#8211; something that would be utterly missing from an analysis within an industry tool. And we&#8217;re barely scratching the surface here.<\/p>\n\n\n\n<figure class=\"wp-block-image\"><a href=\"http:\/\/3.88.229.156\/wp-content\/uploads\/2019\/05\/6.png\"><img loading=\"lazy\" width=\"596\" height=\"154\" src=\"http:\/\/3.88.229.156\/wp-content\/uploads\/2019\/05\/6.png\" alt=\"\" class=\"wp-image-128\" srcset=\"http:\/\/172.31.17.250\/wp-content\/uploads\/2019\/05\/6.png 596w, http:\/\/172.31.17.250\/wp-content\/uploads\/2019\/05\/6-300x78.png 300w\" sizes=\"(max-width: 596px) 100vw, 596px\" \/><\/a><\/figure>\n\n\n\n<p><strong><em>Forensicmike<\/em>: Just confirming, you actually found these images in DCIM\/104APPLE right?<\/strong><\/p>\n\n\n\n<p>Shafik: Yup &#8211; exactly where the database said they would be!<\/p>\n\n\n\n<figure class=\"wp-block-image\"><a href=\"http:\/\/3.88.229.156\/wp-content\/uploads\/2019\/05\/7.png\"><img loading=\"lazy\" width=\"323\" height=\"343\" src=\"http:\/\/3.88.229.156\/wp-content\/uploads\/2019\/05\/7.png\" alt=\"\" class=\"wp-image-129\" srcset=\"http:\/\/172.31.17.250\/wp-content\/uploads\/2019\/05\/7.png 323w, http:\/\/172.31.17.250\/wp-content\/uploads\/2019\/05\/7-283x300.png 283w\" sizes=\"(max-width: 323px) 100vw, 323px\" \/><\/a><\/figure>\n\n\n\n<p> <br><strong><em>Forensicmike<\/em>: <\/strong> <strong>Awesome.. any other data points you&#8217;d like to draw attention to?<\/strong><\/p>\n\n\n\n<p><em>Shafik<\/em>: Of course. Here is a quick non-exhaustive list of some highlights I found. Keep in mind these are specific to iOS 12.1.2.<\/p>\n\n\n\n<div class=\"wp-block-file\"><a href=\"http:\/\/3.88.229.156\/wp-content\/uploads\/2019\/05\/DataPoints-PhotosSQLITE-iOS12_1_2.pdf\">DataPoints-PhotosSQLITE-iOS12_1_2<\/a><a href=\"http:\/\/3.88.229.156\/wp-content\/uploads\/2019\/05\/DataPoints-PhotosSQLITE-iOS12_1_2.pdf\" class=\"wp-block-file__button\" download>Download<\/a><\/div>\n\n\n\n<p><strong><em>Forensicmike<\/em>: What&#8217;s the best way for people to reach you if they have questions?<\/strong><\/p>\n\n\n\n<p>Via Twitter (<a href=\"https:\/\/twitter.com\/qubytelogic\">@qubytelogic<\/a>) is fine &#8211; my direct messages are open.<\/p>\n\n\n\n<p><strong>Thanks a lot Shafik! And thank you readers. If there is interest, perhaps we can move forward on this subject by investigating the use of fuzzy SQL querying to programmatically go&#8230;.<\/strong><\/p>\n\n\n\n<figure class=\"wp-block-image\"><a href=\"http:\/\/3.88.229.156\/wp-content\/uploads\/2019\/05\/vendor.png\"><img loading=\"lazy\" width=\"800\" height=\"600\" src=\"http:\/\/3.88.229.156\/wp-content\/uploads\/2019\/05\/vendor.png\" alt=\"\" class=\"wp-image-133\" srcset=\"http:\/\/172.31.17.250\/wp-content\/uploads\/2019\/05\/vendor.png 800w, http:\/\/172.31.17.250\/wp-content\/uploads\/2019\/05\/vendor-300x225.png 300w, http:\/\/172.31.17.250\/wp-content\/uploads\/2019\/05\/vendor-768x576.png 768w\" sizes=\"(max-width: 800px) 100vw, 800px\" \/><\/a><\/figure>\n","protected":false},"excerpt":{"rendered":"<p>Discussing with Shafik the correlation of photo albums to pictures on iOS using Photos.sqlite.<\/p>\n","protected":false},"author":2,"featured_media":127,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"_mi_skip_tracking":false},"categories":[28,26,1],"tags":[17,11,16,14],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v19.4 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>iOS Photos.sqlite Forensics - forensicmike1<\/title>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/forensicmike1.com\/2019\/05\/02\/ios-photos-sqlite-forensics\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"iOS Photos.sqlite Forensics - forensicmike1\" \/>\n<meta property=\"og:description\" content=\"Discussing with Shafik the correlation of photo albums to pictures on iOS using Photos.sqlite.\" \/>\n<meta property=\"og:url\" content=\"https:\/\/forensicmike1.com\/2019\/05\/02\/ios-photos-sqlite-forensics\/\" \/>\n<meta property=\"og:site_name\" content=\"forensicmike1\" \/>\n<meta property=\"article:published_time\" content=\"2019-05-02T12:28:45+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2019-05-20T01:49:25+00:00\" \/>\n<meta property=\"og:image\" content=\"https:\/\/forensicmike1.com\/wp-content\/uploads\/2019\/05\/5.png\" \/>\n\t<meta property=\"og:image:width\" content=\"406\" \/>\n\t<meta property=\"og:image:height\" content=\"165\" \/>\n\t<meta property=\"og:image:type\" content=\"image\/png\" \/>\n<meta name=\"author\" content=\"Mike Williamson\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<meta name=\"twitter:creator\" content=\"@forensicmike1\" \/>\n<meta name=\"twitter:label1\" content=\"Written by\" \/>\n\t<meta name=\"twitter:data1\" content=\"Mike Williamson\" \/>\n\t<meta name=\"twitter:label2\" content=\"Est. reading time\" \/>\n\t<meta name=\"twitter:data2\" content=\"4 minutes\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"WebSite\",\"@id\":\"http:\/\/172.31.17.250\/#website\",\"url\":\"http:\/\/172.31.17.250\/\",\"name\":\"forensicmike1\",\"description\":\"#DFIR | #RE | #OtherGeekThings =&gt; Views expressed are my own.\",\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":{\"@type\":\"EntryPoint\",\"urlTemplate\":\"http:\/\/172.31.17.250\/?s={search_term_string}\"},\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"WebPage\",\"@id\":\"https:\/\/forensicmike1.com\/2019\/05\/02\/ios-photos-sqlite-forensics\/\",\"url\":\"https:\/\/forensicmike1.com\/2019\/05\/02\/ios-photos-sqlite-forensics\/\",\"name\":\"iOS Photos.sqlite Forensics - forensicmike1\",\"isPartOf\":{\"@id\":\"http:\/\/172.31.17.250\/#website\"},\"datePublished\":\"2019-05-02T12:28:45+00:00\",\"dateModified\":\"2019-05-20T01:49:25+00:00\",\"author\":{\"@id\":\"http:\/\/172.31.17.250\/#\/schema\/person\/9452bbb839546322f3705877143ce492\"},\"breadcrumb\":{\"@id\":\"https:\/\/forensicmike1.com\/2019\/05\/02\/ios-photos-sqlite-forensics\/#breadcrumb\"},\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/forensicmike1.com\/2019\/05\/02\/ios-photos-sqlite-forensics\/\"]}]},{\"@type\":\"BreadcrumbList\",\"@id\":\"https:\/\/forensicmike1.com\/2019\/05\/02\/ios-photos-sqlite-forensics\/#breadcrumb\",\"itemListElement\":[{\"@type\":\"ListItem\",\"position\":1,\"name\":\"Home\",\"item\":\"http:\/\/172.31.17.250\/\"},{\"@type\":\"ListItem\",\"position\":2,\"name\":\"iOS Photos.sqlite Forensics\"}]},{\"@type\":\"Person\",\"@id\":\"http:\/\/172.31.17.250\/#\/schema\/person\/9452bbb839546322f3705877143ce492\",\"name\":\"Mike Williamson\",\"image\":{\"@type\":\"ImageObject\",\"inLanguage\":\"en-US\",\"@id\":\"http:\/\/172.31.17.250\/#\/schema\/person\/image\/\",\"url\":\"http:\/\/2.gravatar.com\/avatar\/540f47dd0fb41a572604e4bf8594c723?s=96&d=mm&r=g\",\"contentUrl\":\"http:\/\/2.gravatar.com\/avatar\/540f47dd0fb41a572604e4bf8594c723?s=96&d=mm&r=g\",\"caption\":\"Mike Williamson\"},\"sameAs\":[\"https:\/\/3.88.229.156\",\"https:\/\/twitter.com\/forensicmike1\"],\"url\":\"http:\/\/172.31.17.250\/author\/forensicmike\/\"}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","yoast_head_json":{"title":"iOS Photos.sqlite Forensics - forensicmike1","robots":{"index":"index","follow":"follow","max-snippet":"max-snippet:-1","max-image-preview":"max-image-preview:large","max-video-preview":"max-video-preview:-1"},"canonical":"https:\/\/forensicmike1.com\/2019\/05\/02\/ios-photos-sqlite-forensics\/","og_locale":"en_US","og_type":"article","og_title":"iOS Photos.sqlite Forensics - forensicmike1","og_description":"Discussing with Shafik the correlation of photo albums to pictures on iOS using Photos.sqlite.","og_url":"https:\/\/forensicmike1.com\/2019\/05\/02\/ios-photos-sqlite-forensics\/","og_site_name":"forensicmike1","article_published_time":"2019-05-02T12:28:45+00:00","article_modified_time":"2019-05-20T01:49:25+00:00","og_image":[{"width":406,"height":165,"url":"https:\/\/forensicmike1.com\/wp-content\/uploads\/2019\/05\/5.png","type":"image\/png"}],"author":"Mike Williamson","twitter_card":"summary_large_image","twitter_creator":"@forensicmike1","twitter_misc":{"Written by":"Mike Williamson","Est. reading time":"4 minutes"},"schema":{"@context":"https:\/\/schema.org","@graph":[{"@type":"WebSite","@id":"http:\/\/172.31.17.250\/#website","url":"http:\/\/172.31.17.250\/","name":"forensicmike1","description":"#DFIR | #RE | #OtherGeekThings =&gt; Views expressed are my own.","potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"http:\/\/172.31.17.250\/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"WebPage","@id":"https:\/\/forensicmike1.com\/2019\/05\/02\/ios-photos-sqlite-forensics\/","url":"https:\/\/forensicmike1.com\/2019\/05\/02\/ios-photos-sqlite-forensics\/","name":"iOS Photos.sqlite Forensics - forensicmike1","isPartOf":{"@id":"http:\/\/172.31.17.250\/#website"},"datePublished":"2019-05-02T12:28:45+00:00","dateModified":"2019-05-20T01:49:25+00:00","author":{"@id":"http:\/\/172.31.17.250\/#\/schema\/person\/9452bbb839546322f3705877143ce492"},"breadcrumb":{"@id":"https:\/\/forensicmike1.com\/2019\/05\/02\/ios-photos-sqlite-forensics\/#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https:\/\/forensicmike1.com\/2019\/05\/02\/ios-photos-sqlite-forensics\/"]}]},{"@type":"BreadcrumbList","@id":"https:\/\/forensicmike1.com\/2019\/05\/02\/ios-photos-sqlite-forensics\/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"http:\/\/172.31.17.250\/"},{"@type":"ListItem","position":2,"name":"iOS Photos.sqlite Forensics"}]},{"@type":"Person","@id":"http:\/\/172.31.17.250\/#\/schema\/person\/9452bbb839546322f3705877143ce492","name":"Mike Williamson","image":{"@type":"ImageObject","inLanguage":"en-US","@id":"http:\/\/172.31.17.250\/#\/schema\/person\/image\/","url":"http:\/\/2.gravatar.com\/avatar\/540f47dd0fb41a572604e4bf8594c723?s=96&d=mm&r=g","contentUrl":"http:\/\/2.gravatar.com\/avatar\/540f47dd0fb41a572604e4bf8594c723?s=96&d=mm&r=g","caption":"Mike Williamson"},"sameAs":["https:\/\/3.88.229.156","https:\/\/twitter.com\/forensicmike1"],"url":"http:\/\/172.31.17.250\/author\/forensicmike\/"}]}},"_links":{"self":[{"href":"http:\/\/172.31.17.250\/wp-json\/wp\/v2\/posts\/120"}],"collection":[{"href":"http:\/\/172.31.17.250\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/172.31.17.250\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/172.31.17.250\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"http:\/\/172.31.17.250\/wp-json\/wp\/v2\/comments?post=120"}],"version-history":[{"count":8,"href":"http:\/\/172.31.17.250\/wp-json\/wp\/v2\/posts\/120\/revisions"}],"predecessor-version":[{"id":138,"href":"http:\/\/172.31.17.250\/wp-json\/wp\/v2\/posts\/120\/revisions\/138"}],"wp:featuredmedia":[{"embeddable":true,"href":"http:\/\/172.31.17.250\/wp-json\/wp\/v2\/media\/127"}],"wp:attachment":[{"href":"http:\/\/172.31.17.250\/wp-json\/wp\/v2\/media?parent=120"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/172.31.17.250\/wp-json\/wp\/v2\/categories?post=120"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/172.31.17.250\/wp-json\/wp\/v2\/tags?post=120"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}